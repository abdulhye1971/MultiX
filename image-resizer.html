<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Resizer Tool</title>
    <style>
        :root {
            --accent: #9B7BFF;
            --secondary-accent: #FFD966;
            --text: #E4E4E4;
            --bg-dark: #0f0820;
            --bg-medium: #24103f;
            --bg-light: #4b1f7a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-medium), var(--bg-light));
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--accent), var(--secondary-accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(155, 123, 255, 0.2);
        }

        .card-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--secondary-accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            font-size: 1.2rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .upload-area:hover {
            border-color: var(--accent);
            background: rgba(155, 123, 255, 0.05);
        }

        .upload-area i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent);
        }

        .upload-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .upload-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        #fileInput {
            display: none;
        }

        .image-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .preview-container {
            width: 100%;
            max-height: 300px;
            overflow: hidden;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
        }

        #imagePreview {
            max-width: 100%;
            max-height: 300px;
            display: none;
        }

        .image-info {
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-weight: 500;
            color: var(--secondary-accent);
        }

        select, input, button {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(155, 123, 255, 0.3);
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background: #8a6cff;
            transform: translateY(-2px);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .dimension-controls {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
        }

        .dimension-controls span {
            text-align: center;
            font-weight: bold;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input {
            width: 18px;
            height: 18px;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .slider-value {
            text-align: right;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .batch-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .batch-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .batch-thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 5px;
            object-fit: cover;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .batch-thumbnail.active {
            border-color: var(--accent);
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
            display: none;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            display: block;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
            display: block;
        }

        .hidden {
            display: none;
        }

        .rotate-flip-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .icon-upload { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>'); }
        .icon-resize { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M21 11V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2zm-4 6H7V7h10v10z"/></svg>'); }
        .icon-download { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>'); }
        .icon-copy { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>'); }
        .icon-reset { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>'); }
        .icon-apply { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>'); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Image Resizer Tool</h1>
            <p class="subtitle">Resize, optimize, and format images for all social media platforms</p>
        </header>

        <div class="grid">
            <!-- Upload Section -->
            <div class="card">
                <h2 class="card-title"><i class="icon icon-upload"></i> Upload Image</h2>
                <div class="upload-area" id="uploadArea">
                    <i class="icon icon-upload"></i>
                    <p class="upload-text">Drag & drop your image here</p>
                    <p class="upload-subtext">or click to browse, paste from clipboard, or enter URL</p>
                    <input type="file" id="fileInput" accept="image/*">
                    <input type="text" id="urlInput" placeholder="Or paste image URL here" style="margin-top: 15px; width: 100%;">
                </div>
                
                <div class="batch-controls">
                    <label>Batch Processing (up to 20 images)</label>
                    <input type="file" id="batchInput" accept="image/*" multiple>
                    <div class="batch-images" id="batchImages"></div>
                </div>
                
                <div class="image-preview">
                    <div class="preview-container">
                        <img id="imagePreview" alt="Image Preview">
                    </div>
                    <div class="image-info">
                        <span id="originalDimensions">Original: -</span>
                        <span id="fileSize">Size: -</span>
                    </div>
                </div>
            </div>

            <!-- Controls Section -->
            <div class="card">
                <h2 class="card-title"><i class="icon icon-resize"></i> Resize Controls</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label for="presetSelect">Social Media & Platform Presets</label>
                        <select id="presetSelect">
                            <optgroup label="Facebook">
                                <option value="1080x1920">Story: 1080 × 1920</option>
                                <option value="820x312">Cover Photo: 820 × 312</option>
                                <option value="180x180">Profile Picture: 180 × 180</option>
                                <option value="1920x1080">Event Cover: 1920 × 1080</option>
                                <option value="1080x1350">Vertical Post: 1080 × 1350</option>
                                <option value="1640x859">Group Cover: 1640 × 859</option>
                                <option value="600x600">Ad (Carousel): 600 × 600</option>
                                <option value="1200x628">Ad (Link): 1200 × 628</option>
                                <option value="1200x628">News Feed: 1200 × 628</option>
                                <option value="1200x630">Shared Image: 1200 × 630</option>
                            </optgroup>
                            <optgroup label="Instagram">
                                <option value="1080x1920">Story: 1080 × 1920</option>
                                <option value="1080x1080">Square Post: 1080 × 1080</option>
                                <option value="110x110">Profile Image: 110 × 110</option>
                                <option value="161x161">Thumbnail: 161 × 161</option>
                                <option value="1080x1350">Vertical Post: 1080 × 1350</option>
                                <option value="1080x566">Horizontal Post: 1080 × 566</option>
                            </optgroup>
                            <optgroup label="Twitter">
                                <option value="400x400">Profile Image: 400 × 400</option>
                                <option value="1500x500">Header: 1500 × 500</option>
                                <option value="440x220">In-Stream Photo: 440 × 220</option>
                                <option value="1024x512">Website Card: 1024 × 512</option>
                                <option value="1200x675">Share Image: 1200 × 675</option>
                                <option value="800x418">Link with Image: 800 × 418</option>
                            </optgroup>
                            <optgroup label="YouTube">
                                <option value="800x800">Channel Icon: 800 × 800</option>
                                <option value="2560x1440">Channel Art: 2560 × 1440</option>
                                <option value="2560x1140">Banner: 2560 × 1140</option>
                                <option value="1280x720">Thumbnail: 1280 × 720</option>
                            </optgroup>
                            <optgroup label="Pinterest">
                                <option value="800x1200">Pin: 800 × 1200</option>
                                <option value="222x150">Board Cover: 222 × 150</option>
                                <option value="165x165">Profile Image: 165 × 165</option>
                                <option value="222x150">Big Thumbnail: 222 × 150</option>
                                <option value="55x55">Small Thumbnail: 55 × 55</option>
                            </optgroup>
                            <optgroup label="LinkedIn">
                                <option value="400x400">Profile Image: 400 × 400</option>
                                <option value="1140x736">Square Image: 1140 × 736</option>
                                <option value="1584x396">Personal Background: 1584 × 396</option>
                                <option value="1536x768">Company Background: 1536 × 768</option>
                                <option value="1200x628">LinkedIn Image: 1200 × 628</option>
                                <option value="300x300">Company Logo: 300 × 300</option>
                                <option value="646x220">Company Banner: 646 × 220</option>
                                <option value="1128x376">Company Hero: 1128 × 376</option>
                                <option value="60x60">Square Logo: 60 × 60</option>
                            </optgroup>
                            <optgroup label="Google Display">
                                <option value="120x600">Skyscraper: 120 × 600</option>
                                <option value="728x90">Leaderboard: 728 × 90</option>
                                <option value="160x600">Wide Skyscraper: 160 × 600</option>
                                <option value="468x68">Banner: 468 × 68</option>
                                <option value="336x280">Large Rectangle: 336 × 280</option>
                                <option value="300x250">Medium Rectangle: 300 × 250</option>
                                <option value="300x600">Half Page: 300 × 600</option>
                                <option value="300x400">Half Banner: 300 × 400</option>
                            </optgroup>
                            <optgroup label="Email & Blog">
                                <option value="750x750">Blog Image: 750 × 750</option>
                                <option value="600x200">Email Header: 600 × 200</option>
                                <option value="1200x600">Blog Header: 1200 × 600</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>Custom Dimensions</label>
                        <div class="dimension-controls">
                            <input type="number" id="widthInput" placeholder="Width" min="1">
                            <span>×</span>
                            <input type="number" id="heightInput" placeholder="Height" min="1">
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="maintainAspect" checked>
                            <label for="maintainAspect">Maintain Aspect Ratio</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Rotation & Flip</label>
                        <div class="rotate-flip-controls">
                            <button id="rotateLeft">Rotate Left</button>
                            <button id="rotateRight">Rotate Right</button>
                            <button id="flipHorizontal">Flip Horizontal</button>
                            <button id="flipVertical">Flip Vertical</button>
                        </div>
                        <input type="number" id="customRotate" placeholder="Custom rotation (degrees)" min="0" max="360">
                    </div>

                    <div class="control-group">
                        <label for="formatSelect">Output Format</label>
                        <select id="formatSelect">
                            <option value="png">PNG</option>
                            <option value="jpeg">JPEG</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>

                    <div class="control-group" id="qualityControl">
                        <label for="qualitySlider">JPEG Quality: <span id="qualityValue">80</span>%</label>
                        <div class="slider-container">
                            <input type="range" id="qualitySlider" min="1" max="100" value="80">
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button id="resizeButton"><i class="icon icon-resize"></i> Resize</button>
                        <button id="resetButton" class="secondary"><i class="icon icon-reset"></i> Reset</button>
                        <button id="applyAllButton"><i class="icon icon-apply"></i> Apply to All</button>
                        <button id="downloadButton"><i class="icon icon-download"></i> Download</button>
                        <button id="copyButton"><i class="icon icon-copy"></i> Copy to Clipboard</button>
                        <button id="useResultButton">Use Result</button>
                    </div>
                </div>

                <div class="status" id="statusMessage"></div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const urlInput = document.getElementById('urlInput');
        const batchInput = document.getElementById('batchInput');
        const batchImages = document.getElementById('batchImages');
        const imagePreview = document.getElementById('imagePreview');
        const originalDimensions = document.getElementById('originalDimensions');
        const fileSize = document.getElementById('fileSize');
        const presetSelect = document.getElementById('presetSelect');
        const widthInput = document.getElementById('widthInput');
        const heightInput = document.getElementById('heightInput');
        const maintainAspect = document.getElementById('maintainAspect');
        const rotateLeft = document.getElementById('rotateLeft');
        const rotateRight = document.getElementById('rotateRight');
        const flipHorizontal = document.getElementById('flipHorizontal');
        const flipVertical = document.getElementById('flipVertical');
        const customRotate = document.getElementById('customRotate');
        const formatSelect = document.getElementById('formatSelect');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const qualityControl = document.getElementById('qualityControl');
        const resizeButton = document.getElementById('resizeButton');
        const resetButton = document.getElementById('resetButton');
        const applyAllButton = document.getElementById('applyAllButton');
        const downloadButton = document.getElementById('downloadButton');
        const copyButton = document.getElementById('copyButton');
        const useResultButton = document.getElementById('useResultButton');
        const statusMessage = document.getElementById('statusMessage');

        // State variables
        let originalImage = null;
        let currentImage = null;
        let rotation = 0;
        let flipH = false;
        let flipV = false;
        let batchImagesData = [];
        let currentBatchIndex = 0;

        // Initialize from localStorage
        function loadSettings() {
            const savedWidth = localStorage.getItem('resizer-width');
            const savedHeight = localStorage.getItem('resizer-height');
            const savedPreset = localStorage.getItem('resizer-preset');
            const savedFormat = localStorage.getItem('resizer-format');
            const savedQuality = localStorage.getItem('resizer-quality');
            
            if (savedWidth) widthInput.value = savedWidth;
            if (savedHeight) heightInput.value = savedHeight;
            if (savedPreset) presetSelect.value = savedPreset;
            if (savedFormat) formatSelect.value = savedFormat;
            if (savedQuality) {
                qualitySlider.value = savedQuality;
                qualityValue.textContent = savedQuality;
            }
            
            // Apply preset if one is saved
            if (savedPreset) applyPreset(savedPreset);
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('resizer-width', widthInput.value);
            localStorage.setItem('resizer-height', heightInput.value);
            localStorage.setItem('resizer-preset', presetSelect.value);
            localStorage.setItem('resizer-format', formatSelect.value);
            localStorage.setItem('resizer-quality', qualitySlider.value);
        }

        // Apply preset dimensions
        function applyPreset(presetValue) {
            if (!presetValue) return;
            
            const dimensions = presetValue.split('x');
            if (dimensions.length === 2) {
                widthInput.value = dimensions[0];
                heightInput.value = dimensions[1];
            }
        }

        // Load image from various sources
        function loadImage(src, name = 'image') {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    originalImage = img;
                    currentImage = img;
                    updatePreview();
                    resolve(img);
                };
                img.onerror = () => reject(new Error('Failed to load image'));
                img.src = src;
            });
        }

        // Update image preview and info
        function updatePreview() {
            if (!currentImage) return;
            
            imagePreview.src = currentImage.src;
            imagePreview.style.display = 'block';
            
            // Update dimensions info
            originalDimensions.textContent = `Original: ${originalImage.width} × ${originalImage.height}`;
            
            // Calculate file size (approximate)
            const sizeInKB = Math.round((currentImage.src.length * 0.75) / 1024);
            fileSize.textContent = `Size: ${sizeInKB} KB`;
        }

        // Resize image
        function resizeImage() {
            if (!originalImage) {
                showStatus('Please upload an image first', 'error');
                return;
            }
            
            const width = parseInt(widthInput.value) || originalImage.width;
            const height = parseInt(heightInput.value) || originalImage.height;
            
            if (width <= 0 || height <= 0) {
                showStatus('Please enter valid dimensions', 'error');
                return;
            }
            
            // Create canvas for resizing
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions
            canvas.width = width;
            canvas.height = height;
            
            // Apply transformations
            ctx.translate(canvas.width / 2, canvas.height / 2);
            
            // Apply flip
            if (flipH) ctx.scale(-1, 1);
            if (flipV) ctx.scale(1, -1);
            
            // Apply rotation
            ctx.rotate(rotation * Math.PI / 180);
            
            // Draw image
            ctx.drawImage(
                originalImage, 
                -width / 2, 
                -height / 2, 
                width, 
                height
            );
            
            // Update current image
            const resizedImage = new Image();
            resizedImage.onload = () => {
                currentImage = resizedImage;
                updatePreview();
                showStatus('Image resized successfully', 'success');
                
                // Emit custom event
                const event = new CustomEvent('imageResizer:result', {
                    detail: {
                        blob: canvas.toBlob(blob => blob),
                        metadata: {
                            width,
                            height,
                            format: formatSelect.value,
                            quality: qualitySlider.value
                        }
                    }
                });
                document.dispatchEvent(event);
            };
            
            // Get format and quality
            const format = formatSelect.value;
            const quality = format === 'jpeg' ? parseInt(qualitySlider.value) / 100 : 1;
            
            resizedImage.src = canvas.toDataURL(`image/${format}`, quality);
            
            // Save settings
            saveSettings();
        }

        // Apply resize to all batch images
        function applyToAllBatchImages() {
            if (batchImagesData.length === 0) {
                showStatus('No batch images to process', 'error');
                return;
            }
            
            const width = parseInt(widthInput.value) || originalImage.width;
            const height = parseInt(heightInput.value) || originalImage.height;
            const format = formatSelect.value;
            const quality = format === 'jpeg' ? parseInt(qualitySlider.value) / 100 : 1;
            
            batchImagesData.forEach((imgData, index) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Apply transformations
                    ctx.translate(canvas.width / 2, canvas.height / 2);
                    if (flipH) ctx.scale(-1, 1);
                    if (flipV) ctx.scale(1, -1);
                    ctx.rotate(rotation * Math.PI / 180);
                    ctx.drawImage(img, -width / 2, -height / 2, width, height);
                    
                    // Update the batch image data
                    batchImagesData[index].resizedDataUrl = canvas.toDataURL(`image/${format}`, quality);
                    batchImagesData[index].resized = true;
                    
                    // Update thumbnail if it's the active one
                    if (index === currentBatchIndex) {
                        currentImage = img;
                        updatePreview();
                    }
                };
                img.src = imgData.dataUrl;
            });
            
            showStatus(`Resize applied to all ${batchImagesData.length} images`, 'success');
        }

        // Download resized image
        function downloadImage() {
            if (!currentImage) {
                showStatus('No image to download', 'error');
                return;
            }
            
            const format = formatSelect.value;
            const link = document.createElement('a');
            link.download = `resized-image.${format}`;
            link.href = currentImage.src;
            link.click();
        }

        // Copy image to clipboard
        function copyToClipboard() {
            if (!currentImage) {
                showStatus('No image to copy', 'error');
                return;
            }
            
            // Create a canvas to get the image data
            const canvas = document.createElement('canvas');
            canvas.width = currentImage.width;
            canvas.height = currentImage.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(currentImage, 0, 0);
            
            canvas.toBlob(blob => {
                const item = new ClipboardItem({ 'image/png': blob });
                navigator.clipboard.write([item])
                    .then(() => showStatus('Image copied to clipboard', 'success'))
                    .catch(err => showStatus('Failed to copy image: ' + err, 'error'));
            });
        }

        // Show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status ' + type;
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                statusMessage.className = 'status';
            }, 3000);
        }

        // Reset to original image
        function resetImage() {
            if (!originalImage) return;
            
            currentImage = originalImage;
            rotation = 0;
            flipH = false;
            flipV = false;
            customRotate.value = '';
            updatePreview();
            showStatus('Image reset to original', 'success');
        }

        // Event Listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--accent)';
            uploadArea.style.background = 'rgba(155, 123, 255, 0.1)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.2)';
            uploadArea.style.background = 'transparent';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.2)';
            uploadArea.style.background = 'transparent';
            
            if (e.dataTransfer.files.length > 0) {
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        urlInput.addEventListener('paste', (e) => {
            // Give a moment for the paste to complete
            setTimeout(() => {
                const url = urlInput.value.trim();
                if (url) {
                    loadImage(url)
                        .then(() => showStatus('Image loaded from URL', 'success'))
                        .catch(() => showStatus('Failed to load image from URL', 'error'));
                }
            }, 10);
        });

        batchInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                batchImagesData = [];
                batchImages.innerHTML = '';
                
                const files = Array.from(e.target.files).slice(0, 20); // Limit to 20
                
                files.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imgData = {
                            dataUrl: event.target.result,
                            name: file.name,
                            resized: false,
                            resizedDataUrl: null
                        };
                        
                        batchImagesData.push(imgData);
                        
                        // Create thumbnail
                        const thumbnail = document.createElement('img');
                        thumbnail.className = 'batch-thumbnail';
                        thumbnail.src = event.target.result;
                        thumbnail.alt = file.name;
                        
                        // Set first image as active
                        if (index === 0) {
                            thumbnail.classList.add('active');
                            loadImage(event.target.result, file.name);
                        }
                        
                        thumbnail.addEventListener('click', () => {
                            // Remove active class from all thumbnails
                            document.querySelectorAll('.batch-thumbnail').forEach(t => {
                                t.classList.remove('active');
                            });
                            
                            // Add active class to clicked thumbnail
                            thumbnail.classList.add('active');
                            
                            // Load the image
                            currentBatchIndex = index;
                            const imgData = batchImagesData[index];
                            loadImage(
                                imgData.resized ? imgData.resizedDataUrl : imgData.dataUrl, 
                                imgData.name
                            );
                        });
                        
                        batchImages.appendChild(thumbnail);
                    };
                    reader.readAsDataURL(file);
                });
                
                showStatus(`Loaded ${files.length} images for batch processing`, 'success');
            }
        });

        presetSelect.addEventListener('change', (e) => {
            applyPreset(e.target.value);
            saveSettings();
        });

        widthInput.addEventListener('input', () => {
            if (maintainAspect.checked && originalImage) {
                const ratio = originalImage.height / originalImage.width;
                heightInput.value = Math.round(parseInt(widthInput.value) * ratio);
            }
            saveSettings();
        });

        heightInput.addEventListener('input', () => {
            if (maintainAspect.checked && originalImage) {
                const ratio = originalImage.width / originalImage.height;
                widthInput.value = Math.round(parseInt(heightInput.value) * ratio);
            }
            saveSettings();
        });

        maintainAspect.addEventListener('change', saveSettings);

        rotateLeft.addEventListener('click', () => {
            rotation = (rotation - 90) % 360;
            customRotate.value = rotation;
            resizeImage();
        });

        rotateRight.addEventListener('click', () => {
            rotation = (rotation + 90) % 360;
            customRotate.value = rotation;
            resizeImage();
        });

        flipHorizontal.addEventListener('click', () => {
            flipH = !flipH;
            resizeImage();
        });

        flipVertical.addEventListener('click', () => {
            flipV = !flipV;
            resizeImage();
        });

        customRotate.addEventListener('input', () => {
            rotation = parseInt(customRotate.value) || 0;
            resizeImage();
        });

        formatSelect.addEventListener('change', () => {
            // Show/hide quality control for JPEG
            qualityControl.style.display = formatSelect.value === 'jpeg' ? 'block' : 'none';
            saveSettings();
        });

        qualitySlider.addEventListener('input', () => {
            qualityValue.textContent = qualitySlider.value;
            saveSettings();
        });

        resizeButton.addEventListener('click', resizeImage);
        resetButton.addEventListener('click', resetImage);
        applyAllButton.addEventListener('click', applyToAllBatchImages);
        downloadButton.addEventListener('click', downloadImage);
        copyButton.addEventListener('click', copyToClipboard);
        useResultButton.addEventListener('click', () => {
            if (currentImage) {
                originalImage = currentImage;
                showStatus('Current result set as new original', 'success');
            }
        });

        // Handle file upload
        function handleFileUpload(file) {
            if (!file.type.match('image.*')) {
                showStatus('Please select an image file', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (event) => {
                loadImage(event.target.result, file.name)
                    .then(() => showStatus('Image loaded successfully', 'success'))
                    .catch(() => showStatus('Failed to load image', 'error'));
            };
            reader.readAsDataURL(file);
        }

        // Initialize the app
        function init() {
            loadSettings();
            
            // Hide quality control for non-JPEG formats initially
            qualityControl.style.display = formatSelect.value === 'jpeg' ? 'block' : 'none';
            
            // Set up paste from clipboard
            document.addEventListener('paste', (e) => {
                if (e.clipboardData.files.length > 0) {
                    handleFileUpload(e.clipboardData.files[0]);
                }
            });
            
            showStatus('Ready to resize images!', 'success');
        }

        // Start the application
        init();
    </script>
</body>
</html>
